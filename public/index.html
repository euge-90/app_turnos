<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="339IIj6DcVrOvAc_MOlHX5oW8DBMOIhJ6GXRBxiHFpk" />
    <title>Reserva de Turnos - Peluquer√≠a</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#ff6b6b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Turnify">
    <link rel="stylesheet" href="css/turnos-calendar.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="images/logo completo.jpeg" alt="Mi Peluquer√≠a" class="logo-img">
            </div>
            <div class="nav-menu">
                <span id="userNameNav" class="user-name"></span>
                <button id="darkModeToggle" class="btn-dark-mode" title="Cambiar tema">üåô</button>
                <button id="logoutBtn" class="btn-logout">Cerrar Sesi√≥n</button>
            </div>
        </div>
    </nav>

    <!-- Tabs de navegaci√≥n -->
    <div class="tabs-container">
        <div class="tabs">
            <button class="tab-btn active" data-tab="turnos">Mis Turnos</button>
            <button class="tab-btn" data-tab="historial">üìú Historial</button>
            <button class="tab-btn" data-tab="perfil">üë§ Mi Perfil</button>
        </div>
    </div>

    <main class="container">
        <!-- TAB: Mis Turnos -->
        <div id="turnosTab" class="tab-content active">
            <!-- Secci√≥n Mis Turnos Activos -->
            <section class="mis-turnos-section">
            <h2>Mis Turnos Activos</h2>
            <div id="misTurnosContainer" class="mis-turnos-container">
                <div class="loading">Cargando tus turnos...</div>
            </div>
        </section>

        <!-- Secci√≥n Reservar Turno -->
        <section class="reservar-section">
            <h2>Reservar Nuevo Turno</h2>

            <!-- Selector de Servicio -->
            <div class="servicio-selector">
                <h3>Selecciona el Servicio</h3>
                <div id="serviciosContainer" class="servicios-grid"></div>
            </div>

            <!-- Calendario -->
            <div class="calendar-section">
                <h3>Selecciona el D√≠a</h3>
                <div class="calendar-controls">
                    <button id="prevMonthBtn" class="btn-month">‚Üê</button>
                    <h4 id="currentMonth"></h4>
                    <button id="nextMonthBtn" class="btn-month">‚Üí</button>
                </div>
                <div id="calendarContainer" class="calendar-grid"></div>
                <div class="calendar-legend">
                    <span class="legend-item"><span class="dot disponible"></span> Disponible</span>
                    <span class="legend-item"><span class="dot completo"></span> Completo</span>
                    <span class="legend-item"><span class="dot no-laboral"></span> Cerrado</span>
                </div>
            </div>

            <!-- Horarios Disponibles -->
            <div id="horariosSection" class="horarios-section" style="display: none;">
                <h3>Horarios Disponibles - <span id="fechaSeleccionada"></span></h3>
                <div id="horariosContainer" class="horarios-grid"></div>
            </div>

            <!-- Confirmaci√≥n -->
            <div id="confirmacionSection" class="confirmacion-section" style="display: none;">
                <h3>Confirmar Reserva</h3>
                <div class="confirmacion-detalle">
                    <p><strong>Servicio:</strong> <span id="confirmServicio"></span></p>
                    <p><strong>Fecha:</strong> <span id="confirmFecha"></span></p>
                    <p><strong>Hora:</strong> <span id="confirmHora"></span></p>
                    <p><strong>Duraci√≥n:</strong> <span id="confirmDuracion"></span> minutos</p>
                    <p><strong>Precio:</strong> $<span id="confirmPrecio"></span></p>
                </div>
                <div class="confirmacion-actions">
                    <button id="confirmarReservaBtn" class="btn-primary">Confirmar Reserva</button>
                    <button id="cancelarReservaBtn" class="btn-secondary">Cancelar</button>
                </div>
            </div>
        </section>
        </div>
        <!-- Fin TAB: Mis Turnos -->

        <!-- TAB: Historial -->
        <div id="historialTab" class="tab-content" style="display: none;">
            <section class="historial-section">
                <h2>üìú Historial de Turnos</h2>

                <!-- Filtros -->
                <div class="historial-filters">
                    <div class="filter-group">
                        <label for="statusFilter">Estado:</label>
                        <select id="statusFilter" class="filter-select">
                            <option value="all">Todos</option>
                            <option value="completed">‚úÖ Completados</option>
                            <option value="cancelled">‚ùå Cancelados</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="periodFilter">Per√≠odo:</label>
                        <select id="periodFilter" class="filter-select">
                            <option value="month">√öltimo mes</option>
                            <option value="3months">√öltimos 3 meses</option>
                            <option value="all">Todo el historial</option>
                        </select>
                    </div>

                    <button id="applyFiltersBtn" class="btn-primary">Aplicar Filtros</button>
                </div>

                <!-- Estad√≠sticas -->
                <div id="historialStats" class="historial-stats">
                    <!-- Se llenar√°n din√°micamente -->
                </div>

                <!-- Lista de turnos -->
                <div id="historialList" class="historial-list">
                    <div class="loading">Cargando historial...</div>
                </div>
            </section>
        </div>
        <!-- Fin TAB: Historial -->

        <!-- TAB: Mi Perfil -->
        <div id="perfilTab" class="tab-content" style="display: none;">
            <section class="perfil-section">
                <h2>üë§ Mi Perfil</h2>
                <div class="perfil-container">
                    <div class="loading">Cargando perfil...</div>
                </div>
            </section>
        </div>
        <!-- Fin TAB: Mi Perfil -->
    </main>

    <footer class="footer">
        <div class="footer-content">
            <p>üìç Direcci√≥n: Av. Principal 1234, CABA</p>
            <p>üìû Tel√©fono: (011) 1234-5678</p>
            <p>‚è∞ Horario: Martes a S√°bado 9:00 - 18:00</p>
        </div>
    </footer>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Toastify.js -->
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <!-- App Scripts -->
    <script src="js/firebase-config.js?v=20241022b"></script>
    <script src="js/auth.js?v=20241022b"></script>
    <script src="js/app.js?v=20241022b"></script>

    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registrado:', registration);
                    })
                    .catch(error => {
                        console.log('Error al registrar Service Worker:', error);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            // Mostrar notificaci√≥n de instalaci√≥n
            const installToast = Toastify({
                text: "üì± ¬°Instala Turnify en tu dispositivo!",
                duration: -1,
                close: true,
                gravity: "bottom",
                position: "center",
                backgroundColor: "linear-gradient(to right, #ff6b6b, #ee5a6f)",
                onClick: function() {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('Usuario acept√≥ instalaci√≥n');
                        }
                        deferredPrompt = null;
                    });
                }
            });
            installToast.showToast();
        });
    </script>
</body>
</html>
